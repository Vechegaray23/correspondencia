<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Escáner QR · MiSitio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --bs-primary: #0d6efd;
      --celeste-light: #e8f7ff;
      --celeste-medium: #b9e4ff;
      --celeste-dark: #59c2ff;
    }
    body {
      background: var(--celeste-light);
      color: #083b66;
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    .section-header {
      color: var(--celeste-dark);
      text-transform: uppercase;
      letter-spacing: .08rem;
      font-size: .9rem;
      margin-bottom: .5rem;
    }
    .card {
      border: none;
      border-radius: 1rem;
      box-shadow: 0 0.5rem 1rem rgba(8,59,102,.15);
    }
    #qr-reader {
      width: 100%;
      min-height: 300px;
      border-radius: 0.5rem;
    }
    .btn-primary {
      background: var(--bs-primary);
      border-color: var(--bs-primary);
    }
    .btn-primary:hover {
      background: var(--celeste-dark);
      border-color: var(--celeste-dark);
    }
  </style>
</head>
<body>

<main class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card bg-white">
        <div class="card-body">
          <h3 class="section-header mb-2">Escáner de código QR</h3>
          <p class="mb-4">Apunta la cámara al código QR para escanearlo automáticamente.</p>

          <!-- Visor QR -->
          <div id="qr-reader" class="mb-3"></div>

          <!-- Resultado -->
          <div class="input-group mb-3">
            <span class="input-group-text"><i class="bi bi-qr-code-scan"></i></span>
            <input id="qr-result" type="text" class="form-control" placeholder="Resultado del escaneo" readonly>
          </div>

          <!-- Controles -->
          <div class="d-flex gap-3">
            <button id="btn-start" class="btn btn-primary flex-fill">
              <i class="bi bi-camera-video"></i> Iniciar
            </button>
            <button id="btn-stop"  class="btn btn-secondary flex-fill" disabled>
              <i class="bi bi-stop-circle"></i> Detener
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script src="https://unpkg.com/html5-qrcode@2.3.9/html5-qrcode.min.js"></script>
<script>
  const qrRegionId = "qr-reader";
  const resultField = document.getElementById("qr-result");
  const startBtn = document.getElementById("btn-start");
  const stopBtn  = document.getElementById("btn-stop");
  const html5QrCode = new Html5Qrcode(qrRegionId);

  function onScanSuccess(decodedText) {
    resultField.value = decodedText;
    // detener después de un escaneo
    html5QrCode.stop().then(() => {
      startBtn.disabled = false;
      stopBtn.disabled  = true;
    });
  }

  startBtn.addEventListener("click", async () => {
    try {
      await html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        onScanSuccess
      );
      startBtn.disabled = true;
      stopBtn.disabled  = false;
    } catch (err) {
      alert("No se pudo acceder a la cámara: " + err);
    }
  });

  stopBtn.addEventListener("click", () => {
    html5QrCode.stop().then(() => {
      startBtn.disabled = false;
      stopBtn.disabled  = true;
      resultField.value = "";
    });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
